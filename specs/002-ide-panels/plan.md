# Implementation Plan: IDE Panels v3

**Branch**: `002-ide-panels` | **Date**: 2026-02-18 | **Spec**: `specs/002-ide-panels/spec.md`
**Input**: Feature specification from `/specs/002-ide-panels/spec.md`

## Summary

v3 update to IDE Panels implementing 4 user clarifications: (1) Files panel opens on the LEFT side of the terminal like a traditional IDE, Git/Preview panels on the RIGHT; (2) Git changed files shown in a vertical sidebar instead of horizontal tabs; (3) Multi-line comment selection made more visible; (4) Batch commenting — add multiple comments across files before submitting all at once.

This is a focused frontend delta. The v1 backend (90 tests) and v2 diff parser (10 tests) are unchanged.

## Technical Context

**Language/Version**: TypeScript 5.7, Node.js 20 LTS
**Primary Dependencies**: React 18, Tailwind CSS 3, Vite 6, @monaco-editor/react, xterm.js 5
**Storage**: SQLite via better-sqlite3 (existing — no schema changes)
**Testing**: Vitest 2.1 (100 tests currently passing)
**Target Platform**: Linux server (Ubuntu), browser client
**Project Type**: Web application (backend + frontend npm workspaces)
**Performance Goals**: File open <2s, diff render <3s, panel switch instant
**Constraints**: Frontend-only changes. No backend modifications.
**Scale/Scope**: 2 frontend files modified, 0 new files

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Comprehensive Testing | PASS | All 100 existing tests must continue passing. No new testable logic (rendering-only changes). |
| II. UX-First Design | PASS | All 4 changes are direct user feedback — UX-driven. |
| III. UI Quality & Consistency | PASS | Files panel left = IDE convention. Sidebar = consistent with file tree pattern. |
| IV. Simplicity | PASS | Minimal changes: 2 files modified, 0 new files, 0 backend changes. |
| V. CI/CD Pipeline | PASS | Will push branch, CI, PR, rebase merge. |
| VI. Frontend Plugin Quality | PASS | No new dependencies. |
| VII. Backend Security | N/A | No backend changes. |
| VIII. Observability | N/A | No backend changes. |

## Project Structure

### Documentation (this feature)

```text
specs/002-ide-panels/
├── plan.md              # This file (v3 update)
├── research.md          # R1-R14 (R12-R14 new for v3)
├── data-model.md        # Unchanged from v1
├── quickstart.md        # Updated for v3 file changes
├── contracts/api.md     # Unchanged from v1
└── tasks.md             # Will be regenerated by /speckit.tasks
```

### Source Code (repository root)

```text
backend/                 # UNCHANGED in v3
├── src/
│   ├── models/
│   ├── services/
│   └── api/
└── tests/

frontend/
├── src/
│   ├── components/
│   │   ├── SessionCard.tsx    # MODIFY: panel positioning (left/right)
│   │   ├── DiffViewer.tsx     # MODIFY: vertical file sidebar + batch comments
│   │   ├── FileTree.tsx       # Unchanged
│   │   ├── FileViewer.tsx     # Unchanged
│   │   ├── LivePreview.tsx    # Unchanged
│   │   └── ...
│   ├── hooks/
│   │   └── usePanel.ts        # Unchanged
│   ├── utils/
│   │   └── diff-parser.ts     # Unchanged
│   └── services/
│       └── api.ts             # Unchanged
└── tests/
    └── unit/
        └── diff-parser.test.ts  # Unchanged
```

**Structure Decision**: Existing web application structure with backend/ and frontend/ workspaces. No structural changes for v3.

## v3 Change Details

### Change 1: Panel Positioning — Files LEFT, Git/Preview RIGHT

**Current**: All panels (files, git, preview) render on the RIGHT side of the terminal in `SessionCard.tsx`. The layout is: `[Terminal | Panel]`.

**Target**: The files panel renders on the LEFT: `[Files Panel | Terminal]`. Git and preview panels remain on the RIGHT: `[Terminal | Git/Preview Panel]`.

**Implementation**: In `SessionCard.tsx`, the main content `<div>` renders terminal first, then panel. For files panel, reverse the order: render files panel first, then terminal. This can be achieved by conditionally ordering the children based on `panel.activePanel`.

**File**: `frontend/src/components/SessionCard.tsx`

### Change 2: Git Changed Files — Vertical Sidebar

**Current**: `DiffViewer.tsx` renders changed files as horizontal tab buttons in a top bar. Clicking a tab shows the diff below.

**Target**: Changed files are rendered in a vertical sidebar (left side of the DiffViewer), similar to the file tree layout in the files panel. The diff viewer area is on the right.

**Implementation**: Restructure `DiffViewer.tsx` layout from:
```
[Header]
[File Tabs (horizontal)]
[Diff Content]
```
to:
```
[Header]
[File Sidebar (vertical, ~180px) | Diff Content]
```

The file sidebar lists files vertically with change type badges (M/A/D/R) and addition/deletion counts. The selected file is highlighted. The sidebar scrolls independently.

**File**: `frontend/src/components/DiffViewer.tsx`

### Change 3: Batch Commenting

**Current**: Each comment is submitted immediately — "Submit" calls `commentsApi.create()` which saves to DB and potentially injects into the PTY.

**Target**: "Submit" becomes "Add Comment" which saves the comment to local React state as a "draft." A "Submit All" button (with count badge) appears in the DiffViewer header. Clicking "Submit All" sends all draft comments to the backend at once. Drafts persist across file switches within the Git panel.

**Implementation**:
- Add `draftComments` state to `DiffViewer` (array of comment objects with draft status)
- "Add Comment" button adds to `draftComments` state, not to backend
- Draft comments render inline on their respective lines with a "Draft" badge
- "Submit All" button in the header iterates through `draftComments`, calls `commentsApi.create()` for each, moves them to `existingComments` with status updated
- Badge on "Submit All" shows `draftComments.length`

**File**: `frontend/src/components/DiffViewer.tsx`

### Change 4: Multi-Line Comments (Documentation Only)

**Current**: Multi-line selection via shift-click already works in v2. The "+" gutter icon and shift-click behavior are implemented.

**Target**: No code change needed. The spec has been updated to explicitly document this capability.

## Complexity Tracking

No constitution violations. All changes are minimal frontend rendering adjustments.
